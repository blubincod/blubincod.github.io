---
layout: post
title: "API ì„¤ê³„"
description: >
    API ì„¤ê³„ ë°©ì‹ì„ ì•Œì•„ë³´ê¸°.
categories: [studylog, documentation]
related_posts: [/studylog/documentation/Spring&SpringBoot/, 
/studylog/documentation/SpringBoot-Validation-Exception/,
/studylog/documentation/SpringBoot-Actuator/]
comments: false
sitemap: false
cover:  false
image: 
  path: /assets/study/spring/springBoot/S2S.jpg
---

* this unordered seed list will be replaced by toc as unordered list 
{:toc}


## APIë€ 
<hr>

`MSA`ì™€ ê°™ì´ ë‹¤ë¥¸ ì„œë²„ë¡œ ì›¹ ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ”<br>RestTemplateê³¼ WebClientì— ëŒ€í•´ ì•Œì•„ë³´ì.
{:.lead}

```md
ğŸ’¡ MSAë€?
ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜(MSA)ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê°€ì§€ê³  ìˆëŠ” ê¸°ëŠ¥(ì„œë¹„ìŠ¤)ì´ í•˜ë‚˜ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë²”ìœ„ë§Œ ê°€ì§€ëŠ” í˜•íƒœ.
```

### RestTemplateì´ë€?
<hr>

> ìŠ¤í”„ë§ì—ì„œ HTTP í†µì‹  ê¸°ëŠ¥ì„ ì†ì‰½ê²Œ ì‚¬ìš©í•˜ë„ë¡ ì„¤ê³„ëœ í…œí”Œë¦¿.

- RESTful í˜•ì‹ì„ ê°–ì¶˜ í…œí”Œë¦¿.
- ë™ê¸° ë°©ì‹ ì²˜ë¦¬(default) / ë¹„ë™ê¸° ë°©ì‹ì€ `AsyncRestTemplate` ì‚¬ìš©.
- HTTP ìš”ì²­ í›„ JSON, XML, ë¬¸ìì—´ ë“±ì˜ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µ ë°›ìŒ.
- ë¸”ë¡œí‚¹ I/O ê¸°ë°˜ì˜ ë™ê¸° ë°©ì‹ì„ ì‚¬ìš©.
- ë‹¤ë¥¸ APIë¥¼ í˜¸ì¶œ ì‹œ HTTP í—¤ë”ì— ë‹¤ì–‘í•œ ê°’ ì„¤ì • ê°€ëŠ¥.

#### RestTemplate ë™ì‘ ì›ë¦¬ 
<hr>

1. RestTemplate ì„ ì–´í•˜ê³  URIì™€ HTTP ë©”ì„œë“œ, Body ë“±ì„ ì„¤ì •í•œë‹¤.

2. ì™¸ë¶€ APIë¡œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ë©´ HttpMessageConverterë¥¼ í†µí•´ RequestEntityë¥¼ ìš”ì²­ ë©”ì‹œì§€ ë³€í™˜í•œë‹¤.

3. ìš”ì²­ëœ ë©”ì‹œì§€ë¥¼ CLientHttpRequestFactoryë¥¼ í†µí•´ ClientHttpRequestë¡œ ê°€ì ¸ì˜¨ í›„ ì™¸ë¶€ APIë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.

4. ì™¸ë¶€ì—ì„œ ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ ë°›ìœ¼ë©´ RestTemplateì€ ResponseErrorHandlerë¡œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ê³ , ì˜¤ë¥˜ê°€ ìˆë‹¤ë©´ ClientHttpResponseì—ì„œ ì‘ë‹µ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•œë‹¤.

5. ë°›ì€ ì‘ë‹µ ë°ì´í„°ê°€ ì •ìƒì´ë¼ë©´ ë‹¤ì‹œ í•œë²ˆ HttpMessageConverterë¥¼ ê±°ì³ ìë°” ê°ì²´ë¡œ ë³€í™˜í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë°˜í™˜í•œë‹¤.

#### RestTemplate ì‚¬ìš©í•˜ê¸°
<hr>

##### RestTemplate êµ¬í˜„í•˜ê¸°
```java
@Service
public class RestTmeplateService {
    
    public String getName() {
        URI rui = UriCompomnentsBuilder
        .fromUriString("http://localhost:9090")
        .path("api/v1/crud-api")
        .encode()
        .build()
        .toUri();
        
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        
        return responseEntity.getBody();
    }
    
    public String getNameWithPathVariable(){
        URI uri = UriComponentsBuilder
                .fromUriString("http://localhost:9090")
                .path("/api/v1/crud-api/{name}")
                .encode()
                .build()
                .expand("Flature") // ë³µìˆ˜ì˜ ê°’ì„ ë„£ì–´ì•¼ í•  ê²½ìš° ','ë¥¼ ì¶”ê°€í•˜ì—¬ êµ¬ë¶„
                .toUri();
        
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        
        return responseEntity.getBody();
    }
    
    public String getNameWithParameter(){
        URI uri = UriComponentsBuilder
                .fromUriString("http://localhost:9090")
                .path("/api/v1/crud-api/param")
                .queryParam("name", "Flature")
                .encode()
                .build()
                .toUri();
        
        RestTemplate restTemplate = new RestTemplate();
        ResponseEntity<String> responseEntity = restTemplate.getForEntity(uri, String.class);
        
        return responseEntity.getBody();
    }
}
```
RestTemplateServiceì˜ GET ì˜ˆì œ
{:.figcaption}

### WebClientë€?
<hr>

ì¼ë°˜ì ìœ¼ë¡œ ì‹¤ì œ ìš´ì˜í™˜ê²½ì— ì ìš©ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì •ì‹ ë²„ì „ìœ¼ë¡œ ì¶œì‹œëœ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ë²„ì „ë³´ë‹¤ ë‚®ì€ ê²½ìš°ê°€ ë§ê¸°ì— RestTemplateì„ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆë‹¤.
{:.faded}

í˜„ì¬ `RestTemplate`ì„ ì§€ì› ì¤‘ë‹¨(deprecated)ëœ ìƒíƒœë¼ ìµœì‹  ë²„ì „ì—ì„œëŠ”<br> 
WebClientë¥¼ ì‚¬ìš©í•  ê²ƒì„ ê¶Œê³ í•˜ê³  ìˆê¸°ì—, `WebClient` ë°©ì‹ ë˜í•œ ì•Œì•„ë‘ì–´ì•¼ í•œë‹¤.
{:.lead}


#### WebClient ì‚¬ìš©í•˜ê¸°
<hr>

#### WebFlux ì˜ì¡´ì„± ì¶”ê°€í•˜ê¸°
<hr>

> WebClientë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ WebFlux ëª¨ë“ˆì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```java
<dependencies>
    ...
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-webflux</artifactId>
    </dependency>
    ...
</dependencies>
```
WebFlux ì˜ì¡´ì„± ì¶”ê°€
{:.figcaption}


##### WebClient êµ¬í˜„í•˜ê¸°
<hr>

> WebClientë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•

- create()
- builder() 



```java
@Service
public class WebClientService { 
    
    public String getName() {
        WebClient webClient = WebClient.builder()
            .baseUrl("http://localhost:9090")
            .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
            .build();
        
        return webClient.get()
            .uri("/api/vi/crud-api")
            .retrieve()
            .bodyToMono(String.class)
            .block();
    }
    ...
}
```
builder()ë¥¼ í™œìš©í•´ WebClient ìƒì„±.
{:.figcaption}


```java
@Service
public class WebClientService { 
    
    ...
    
    public String getNameWithPathVariable() {
        WebClient webClient = WebClient.create("http://localhost:9090");
        
        ResponseEntity<String> respnseEntity = webClient.get()
            .uri(uriBuilder -> uriBuilder.path("/api/v1/crud-api/{name}")
            .build("Flature"))
            .retrieve().toEntitty(string.class).block();
            
            return responseEntity.getBody(); 
    }
}
```
create()ë¥¼ í™œìš©í•´ WebClient ìƒì„±.
{:.figcaption}

> WebClient ê°ì²´ë¥¼ ìƒì„±í•œ í›„ ì¬ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¢‹ìœ¼ë©°<br>builder()ë¥¼ ì‚¬ìš©í•  ê²½ìš° ì•„ë˜ ë©”ì„œë“œë¡œ í™•ì¥ì´ ê°€ëŠ¥í•˜ë‹¤.

- defaultHeader(): WebClientì˜ ê¸°ë³¸ í—¤ë” ì„¤ì •
- defaultCookie(): WebClientì˜ ê¸°ë³¸ ì¿ í‚¤ ì„¤ì •
- defaultUriVariable(): WebClientì˜ ê¸°ë³¸ URI í™•ì¥ê°’ ì„¤ì •
- filter(): WebClientì—ì„œ ë°œìƒí•˜ëŠ” ìš©ì²­ì— ëŒ€í•œ í•„í„° ì„¤ì •

## ì •ë¦¬
<hr>
ë‹¤ë¥¸ ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ìƒí™©ì€ ìì£¼ ë°œìƒí•˜ë¯€ë¡œ ìœ„ì—ì„œ ì†Œê°œí•œ í†µì‹  ëª¨ë“ˆì„ ì‚¬ìš©í•˜ì—¬ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

## ğŸ“„ ì°¸ê³ ë¬¸ì„œ
<hr>
<a href="https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=296591989">ìŠ¤í”„ë§ ë¶€íŠ¸ í•µì‹¬ ê°€ì´ë“œ</a> ì±…ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

Continue with [ì—°ê´€ê´€ê³„ ë§¤í•‘](2024-05-25-SpringBoot-RelationMapping.md){:.heading.flip-title}
{:.read-more}